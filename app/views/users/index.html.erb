<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<style>
.home_container{
  width:100%;
  height:600px;
  background-color: #B4CDCD;
}
.home_map{
  height:100%;
  width:70%;
  float:right;
}
.home_side_bar{
  display:inline-block;
  margin: 5px;
}
#geolocation{
  height:100%;
  width:70%;
  float:right;
  margin: 10px;
}

.styledButton{
  background: rgb;
}

</style>

<p id="notice"><%= notice %></p>
<div class='home_container'>
  <div class='home_side_bar'>
    <%= form_for @pin do |pin_form| %>
      <%= pin_form.text_field :title,       :placeholder => 'Title' %><br/>
      <%= pin_form.text_field :description, 
        :placeholder => 'Description', 
        class: 'pin_form_desc' 
      %><br/>
      <%= pin_form.text_field :latitude,    
        :placeholder => 'Latitude', 
        class: 'pin_form_lat' 
      %><br/>
      <%= pin_form.text_field :longitude,   
        :placeholder => 'Longitude', 
        class: 'pin_form_long' 
      %><br/>
      <%= pin_form.text_field :user_id,     
        :placeholder => 'User ID' 
      %><br/>
      <%= pin_form.submit 'Pin Me' , class: 'btn btn-success' %>
    <% end %>
  </div>  

  <div class='home_map'>
    <div id="geolocation"></div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function(){
    var handler = Gmaps.build('Google');
    handler.buildMap({ internal: {id: 'geolocation'} }, function(){
      if(navigator.geolocation)
        navigator.geolocation.getCurrentPosition(displayOnMap);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
  });

  function displayOnMap(position){
    var marker = handler.addMarker({
      lat: position.coords.latitude,
      lng: position.coords.longitude
    });
    console.log(position)
    handler.map.centerOn(marker);
  };
  
  function initialize() {
    var styleArray = [
    {
      featureType: "all",
      stylers: [
        { saturation: 40 }
      ]
    }, {
      featureType: "landscape", 
      elementType: "geometry",
      stylers: [
        { hue: "#2E2E2E" }
      ]
    }, {
      featureType: "road.arterial",
      elementType: "geomtry", 
      stylers: [
        { hue: "#FE2EF7" }
      ]
    }, {
      featureType: "water", 
      elementType: "geometry", 
      stylers: [
        { hue: "#00ffee" }
      ]
    }
    ] 
    var styledMap = new google.maps.StyledMapType(styles,
      {name: "Styled Map"});

    var mapOptions = {
      zoom: 11,
      center: new google.maps.LatLng(55.6468, 37.581),
      mapTypeControlOptions: {
        mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
      }
    };
    var map = new google.maps.Map(document.getElementById('map'),
      mapOptions);

    map.mapTypes.set('map_style', styledMap);
    map.setMapTypeId('map_style');
  };
</script>
